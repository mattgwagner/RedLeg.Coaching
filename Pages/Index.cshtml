@page
@model RedLeg.Coaching.IndexModel

@if (!Model.Cards.Any())
{
    <h2>No One-on-Ones found, contact your Mentor to configure access.</h2>
    <h4>Authenticated Email: @Model.Email</h4>
}

<ul class="nav nav-tabs" role="tablist">
    @foreach (var card in Model.Cards)
    {
        <li class="nav-item">
            <a class="nav-link" href="#@card.Id">@card.Board.Name - @card.Name</a>
        </li>
    }
</ul>

@foreach (var card in Model.Cards)
{
    <div class="tab-content">
        <div class="tab-pane fade show active" id="@card.Id">
            @foreach (var checklist in card.CheckLists.OrderByDescending(_ => _.Name))
            {

                <h2>@checklist.Name</h2>

                <ul class="list-group">
                    @foreach (var item in checklist.CheckItems.OrderBy(i => i.State).ThenBy(i => i.Position))
                    {
                        var is_checked = item.State == Manatee.Trello.CheckItemState.Complete;

                        <li class="list-group-item @(is_checked ? "disabled" : "")">
                            <form method="post" asp-page-handler="ToggleCheck">
                                <input hidden name="cardId" value="@card.Id" />
                                <input hidden name="checklistitem" value="@item.Id" />
                                <input hidden name="isChecked" value="@(is_checked ? "false" : "true")" />
                                <input type="checkbox" @(is_checked ? "checked=checked" : "") onchange="this.form.submit()" />
                                @item.Name
                            </form>
                        </li>
                    }

                    <li>
                        <form method="post" asp-page-handler="AddItem">
                            <input hidden name="cardId" value="@card.Id" />
                            <input hidden name="checklist" value="@checklist.Id" />
                            <input name="text" type="text" />
                            <button type="submit" class="btn btn-info btn-xs">Add</button>
                        </form>
                    </li>
                </ul>

            }
        </div>
    </div>

}